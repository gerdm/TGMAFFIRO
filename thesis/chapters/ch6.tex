\documentclass[../TGMAFFIRO.tex]{subfiles}

\begin{document}
\section{Markets}
\begin{definition}[\textbf{Markets}]
	A market $X(t) = \{X_i(t)\}_{i=0}^n$ is an $\salgF^{(m)}_t$-adapted $n+1$ It\^o Process where
	\begin{equation}
		dX_0 = r(t,\omega) X_0(t) dt; \ X(0) = 1; \label{eq:safe_investment}
	\end{equation}
	
	and
	\begin{equation}
		dX_i = \mu_i(t,\omega) dt + \sum_{j=1}^{m}\sigma_{ij}(t,\omega)dW_j(t) \label{eq:risky_asset}.
	\end{equation}
\end{definition}

We regard (\ref{eq:safe_investment}) as the safe asset in the market due the lack of a diffusion term. With this in mind, $r$ represents the average rate of return for the safe investment\\

On the other hand, (\ref{eq:risky_asset}) represent a risky asset. In this context, $\mu_i$ represent the drift term or, in other words, the average rate of return for asset $i$, while $\sigma_{ij}$ represents the amount of variation for the asset $i$ (note that we are generally defining a risky asset as a sum of different \textit{uncertainty} factors). In effect, $\sigma_{ij}$ is the diffusion term of the stock.\\

For a more convenient notation, let $W(t) = \{W_i(t)\}_{i=1}^{m}$ be represented by a $m\times 1$ matrix and $\sigma_i$ by a $1\times m$ matrix of elements $\{\sigma{ij}\}_{j=1}^{m}$ then,
\begin{equation}
  dX_i = \mu_i(t,\omega) dt + \sigma_idW(t).
\end{equation}

\begin{definition}[\textbf{Normalized Markets}]
	The market $\market$ is said to be normalized if $X_0(0)= 1$
\end{definition}

We may define a normalized market transforming every entry of $\market$ as $\bar{X_i}(t) = X_0^{-1}(t)X_i(t)$. It follows that
\begin{equation}
  \bar{X}(t) = (1, \bar{X}_1(t), \ldots, \bar{X}_n(t))
\end{equation}

As pointed out by \aycite{oksendal}, normalizing the market ``corresponds to regarding the price $X_0(t)$ of the safe investment as the unit of price (the numeraire) and computing the other prices in therms of this unit.''

\begin{remark}
	Since $dX_0 = r X_0 dt$, we see that $X_0(t) = e^{\int_0^tr(s,\omega) ds}$. Let
	\begin{equation}
		\nu(t) := X^{-1}_0(t) = e^{-\int_0^tr(s,\omega) ds}.
	\end{equation}
This implies
\begin{align}
	d\bar X_i &= d\left(\nu(t)X_i(t)\right) \nonumber \\
			&= \nu(t)dX_i + X_id\nu(t) + d\nu(t)dX_i(t)\nonumber\\
			&= \nu(t) [\mu_i dt + \sigma_i dW(t)] + X_i[\nu(t))(-r dt)] + \nonumber\\
			&\phantom{{}=1} [\nu(t)(-r dt)\cdot(\mu_i dt + \sigma_i dW(t))]\nonumber\\
			&=\nu(t)[(\mu_i - r X_i)dt + \sigma_i dW(t)] \label{eq:discounted_market}.
\end{align}

Considering (\ref{eq:discounted_market}) as $d\XBar_i(t) = \nu(t)[(\mu_i dt + \sigma_i dW(t)) - r X_i(t)] = \nu(t)[dX_i(t) - r X_i(t)]$, we can represent the discounted market in the following matrix form:
\begin{equation}
  d\XBar(t) = \nu(t)[dX(t) - r X(t)]. \label{eq:discounted_market_matrix}
\end{equation}

\end{remark}

\begin{definition}[\textbf{Portfolio}]
	A portfolio $\theta(t)$ in the market $\market$ is an ($n+1$)-dimensional $(t,\omega)$-measurable and $\salgF_t^{(m)}$-adapted stochastic process
	\begin{equation}
		\theta(t,\omega) = \{\theta_{i}(t,\omega)\}_{i=0}^{n} \ \forall \ t\in[0, T].
	\end{equation}
\end{definition}

The value $\theta_i(t,\omega)$ represents the amount of units for the asset $X_i$ held at time $t$.

\begin{definition}[\textbf{The value process}]
	The value at time $t$ for the portfolio $\theta$ is defined as
	\begin{equation}
		V(t) = \innerprod{\theta(t)}{X(t)} = \theta(t) \cdot X(t)
	\end{equation}
\end{definition}
The value $\theta_i(t,\omega)$ represents the amount of units for the asset $X_i$ held at time $t$.

\begin{definition}[\textbf{Self-financing portfolio}]
	The portfolio $\theta(t)$ is said to be self-financing if
	\begin{equation}
	\int_0^T\{|\theta_0r(s)X_0(s) + \sum_{i=1}^{n}\theta_i(s)\mu(s)| + \sum_{j=1}^m\left[\sum_{i=1}^n\theta_i(s)\sigma_{ij}(s)\right]^2\} ds < \infty,
	\end{equation}
and 
\begin{equation}
  dV(t) = \innerprod{\theta(t)}{dX(t)} \iff V(t) = V(0)  + \int_0^t \theta(s) dX(s).
\end{equation}

The change in the value of the portfolio is given uniquely by the change in the value of the asset; there is no influx or outflow of money for every $t\in(0,T]$.
\end{definition}

\begin{remark}
	Let $\theta$ be self-financing in the market $\market$ and denote
	\begin{equation}
		\valueProcessNorm{t} = \theta(t)\bar X(t) = \nu(t) \valueProcess{t}
	\end{equation}
	
the normalized (or discounted) value process.

Then,
\begin{align}
	d\valueProcessNorm{t	} &= \nu(t) d\valueProcess{t} + d\nu(t) \valueProcess{t} + d\nu(t) d\valueProcess{t}\nonumber\\
	&= \nu(t)\theta(t)dX(t) + \valueProcess{t}\nu(t)(-r(t)dt)\nonumber\\
	&= \theta(t)\nu(t)\left[dX(t) - X(t)r(t)dt\right]\nonumber\\
	&= \theta(t)d\XBar(t).\label{eq:change_norm_value_process}
\end{align}

Where (\ref{eq:change_norm_value_process}) follows from (\ref{eq:discounted_market_matrix}). We conclude that $\theta$ is also self-financing in $\normarket$.
\end{remark}


\begin{definition}[\textbf{Admissible Portfolio}]
	A self-financing portfolio is said to be admissible if $\valueProcessNorm{t}$ is (a.s) lower bounded. i.e., there exists $L < \infty$ such that
	\begin{equation}
		\valueProcess{t, \omega}  \geq -L \ \text{for a.a. } (t,\omega) \in [0,T]\times \Omega.
	\end{equation}
\end{definition}

\begin{definition}[\textbf{An arbitrage}]
	An admissible portfolio is said to be an arbitrage if $V(0) = 0$ and
	\begin{itemize}
		\item $\valueProcess{T} \geq 0$ a.s.; and
		\item $\Pm\left(\valueProcess{T} > 0 \right) > 0$.
	\end{itemize}
\end{definition}

It turns out that having a market constraint to only admissible portfolios lead to a market with arbitrage (see \aycite{oksendal}). We are interested in markets where no arbitrage is possible. If so, what requirements other constraints are necessary for $\market$ such that no arbitrage is possible?

\begin{definition}
	A measure $\Qm \sim \Pm$ for which the normalized price process $\normarket$ is a (local) martingale w.r.t. $\Qm$ is called an equivalent local martingale measure (EMM).
\end{definition}

\begin{proposition}
	Suppose there exists an equivalent local martingale measure $\Qm$ for the market $\normarket$ then $\market$ is an arbitrage-free market.
\end{proposition}

\begin{proposition}\label{prop:qmartingale-market}
	Suppose there exists an $m$-dimensional process $u$ in the extended family for It\^o integrals, where $X(t, \omega) = \{X_i(t,\omega)\}_{i=1}^n$ and
	\begin{equation}
		\sigma(t,\omega)u(t,\omega) = \mu(t, \omega) - r(t, \omega)X(t,\omega).
	\end{equation}

Let us define the measure $\Qm$, and the process $\QBm{t}$ such that
\[
	d\Qm(\omega) = e^{-\int_0^Tu(t,\omega) dW(t) - \frac{1}{2}\int_0^Tu^2(t,\omega) dt}d\Pm,
\]

and
\[
	\QBm{t} := \int_0^tu(s,\omega) ds + W(t).
\]
Then,
\begin{enumerate}
	\item $\QBm{t}$ is a Brownian motion and a $\salgF_t^{(m)}$-martingale w.r.t. $\Qm$;
	\item The representation of the normalized market $\normarket$ is given by
	\begin{align*}
		d\XBar_0(t) &= 0 \\
		d\XBar_i(t) &= \nu(t)\sigma_i d\QBm{t}
	\end{align*}
\end{enumerate}
\end{proposition}

\begin{proof}
	The first part of \ref{prop:qmartingale-market} follows from the Girsanov theorem. For the second one consider $d\XBar_i$ and (\ref{eq:discounted_market}) then,
	\begin{align*}
		d\XBar_i &= d(\nu(t)X_i(t)) \\
		&= \nu(t)[(\mu_i - r X_i)dt + \sigma_i dW(t)]\\
		&= \nu(t)[(\mu_i - r X_i)dt + \sigma_i (d\QBm{t} - u_i(t)dt)]\\
		&= \nu(t)[(\mu_i - r X_i)dt + \sigma_i (d\QBm{t} - \frac{\mu_i - r X_i(t)}{\sigma_i})dt]\\
		&= \nu(t)\sigma_id\QBm{t}.
	\end{align*}
\end{proof}

\begin{definition}[\textbf{Claims}]
\begin{enumerate}
	\item A contigent claim $T$ is a lower bounded $\salgF_t^{(m)}$-measurable random variable $C(\omega)$;
	\item A claim $C(\omega)$ is said to be attainable if there exists an admissible portfolio $\theta(t)$ and $z\in\RNums$ such that
	\[
		C(\omega) = V_z^{\theta}(T) := z + \int_0^T \theta(t)dX(t) \text{a.s. and,}
	\]
	
	\begin{equation}
		\valueProcessNorm{T}	 = z + \int_0^t \nu(s)\sum_{i=1}^{n}\theta_i(s)\sigma_i(s) dW^\Qm_s \ \forall \ 0 \leq t \leq T
	\end{equation} 
	is a $\Qm$-martingale. If such $\theta$ exists, it is called a replicating portfolio.
	% with z as our initial fortune we can ﬁnd an admissible portfolio θ(t) which generates a value V z θ (T) at time T which a.s. equals F: V_z^\theta(T,\omega) = C(\omega) for a.a, \omega
	\item A market $\market$ is said to be complete if every bounded claim at time $T$ is attainable.
\end{enumerate}
\end{definition}

\textbf{
In what follows, we will assume $u(t,\omega) \in \Nhatfam{0}{T}$ such that
\begin{equation}\label{eq:condition_change_measure}
	\sigma(t,\omega) u(t,\omega) = \mu(t,\omega) - r(t,\omega) X_t,
\end{equation}
and let $\Qm$, and $W_t^\Qm$ such that
\begin{align}
  d\Qm = e^{-\left(\int_0^t u(t,\omega) dW_t + \frac{1}{2}\int_0^T u^2(t,\omega) dt\right)} d\Pm \label{eq:emmq} \\
  W^\Qm_t := \int_0^t (s,\omega) ds + W_t
\end{align}
}



\begin{theorem}\label{th:arbitrage_free_market}
	Suppose there exists a process $u(t,\omega) \in \Nhatfam{0}{T}$ for $X(t,\omega) = (X_1(t,\omega), \ldots, X_n(t,\omega))$ such that
	\begin{equation}
		\sigma(t,\omega) u(t,\omega) = \mu(t, \omega) - \rho(t,\omega) X(t,\omega)
	\end{equation}
	for a.a. $(t,\omega)$ and such that
	
	\begin{equation}\label{eq:condition_arbitrage_free_market}
		\Exp{e^{\frac{1}{2}u^2(t,\omega) dt}} < \infty.
	\end{equation}
	
	Then the market has no arbitrage.
\end{theorem}

\begin{theorem}\label{th:complete_market}
	The market $\market$ is a compete if and only if there exists $\sigma(t,\omega)$ invertible for a.a. $(t,\omega)$:
		
	\begin{equation}
		\sigma^{-1}(t,\omega) \sigma(t,\omega) = I_m \Rightarrow Rank(\sigma) = m
	\end{equation}
\end{theorem}

\begin{theorem}
	Let $C$ a European claim at time $T$ such that $\ExpMeasure{\Qm}{\nu(t)C} < \infty$ for a given complete market $\market$. Then, the price of $C$ is
	
	\begin{equation}
		p(C) = q(C) = \ExpMeasure{\Qm}{\nu(t)C}
	\end{equation}

\end{theorem}

\section{Black-Scholes}
For now on, we assume a market that consists of two securities: a bond, or cash account, ($B_t$), and a stock ($S_t$). By doing this, we are effectively accessing a market with a risk-free security and a risky one. The dynamics of these two securities are as follows:
\begin{itemize}
	\item $dB_t = r B_t dt$
	\item $dS_t = S_t(\mu dt + \sigma dW_t)$
\end{itemize}

With $r, \mu, \sigma \in \RNums$.

\begin{theorem}[\textbf{Black-Scholes Equation}]
	Consider a payoff $g(\omega)$ at time $T$. The price of the payoff at time $0\leq t\leq T$ is given by $C(t,S_t)$, where $C$ is the solution to the partial differential equation
	
	\begin{equation}\label{eq:black-scholes-formula}
		\partialwrt{C}{t} + \frac{1}{2}\sigma^2S^2\partialwrt[2]{C}{S} + rS\partialwrt{C}{S} - rC = 0,
	\end{equation}

with final boundary condition $C(T,S_T) = g(S_T)$.
\end{theorem}

% We will prove the Black-Scholes formula vía replication following a rather informal, yet enlightning, argument
\begin{proof}
	Let $C(t, S_t)$ the value of the payoff at time $t$ and $dS_t = S_t(\mu dt + \sigma dW_t)$ the dynamics of the stock. The derivative of $C$ is given by
	\begin{align}
		dC(t,S_t) &= \partialwrt{C}{t}{(t, S_t)} dt + \partialwrt{C}{s}{(t, S_t)} dS_t + \frac{1}{2}\partialwrt[2]{C}{s}{(t, S_t)} (dS_t)^2 \nonumber \\
			&= \partialwrt{C}{t}{(t, S_t)} dt + \partialwrt{C}{s}{(t, S_t)} (\mu dt + \sigma dW_t) + \frac{1}{2}\partialwrt[2]{C}{s}{(t, S_t)} (S_t\sigma)^2 dt \nonumber\\
			&= \left(\partialwrt{C}{t}{(t, S_t)} + \mu S_t\partialwrt{C}{s}(t, S_t) + (S_t\sigma)^2\frac{1}{2}\partialwrt[2]{C}{s}{(t, S_t)} \right) dt  + S_t\sigma\partialwrt{C}{s}{(t, S_t)} dW_t\nonumber
	\end{align}
	
	In order to make the notation readable, we denote $C_x = \partialwrt{C}{x}{(t, S_t)}$, and $C_{xx} = \partialwrt[2]{C}{x}{(t, S_t)}$. For which we rewrite
	\begin{equation}
		dC(t, S_t) = \left(C_t + \mu S_t C_s + \frac{1}{2}(S_t\sigma)^2C_{ss} \right) dt  + S_t\sigma C_s dW_t\nonumber
	\end{equation}
	
	Since $C(T, S_T)$ represents the contingent final payoff, then $C(0, S_0)$ is to be the price of the portfolio that replicates the payoff of the option, i.e., the value of the option. On the other hand, we know that the value of the replicating portfolio is given by
	
	\begin{equation} \label{eqproof:value_porfolio_bs_1}
		d\valueProcess{t} = \theta_0(t)dX_0  + \theta_1 dX_1
	\end{equation}
	
	Let us denote $\pi(t)$ as the total amount of money held in the stock at time $t$, i.e., value of the portfolio considering only the stocks. 	Recall that $\theta_0(t)$ and $\theta_1(t)$ represent total of units in the bank (resp. stock) held at time $t$. With this in mind, we can represent the total units held in stock as the total value given by the stocks divided by the market value of a single stock ($\pi(t) / X_1(t)$). Conversely, we can represent the total units in the bank account as the value of the portfolio given by the value in the bank account divided by the value the bank account at time $t$ ($(\valueProcess{t} - \pi(t)) / X_0(t)$) with this in mind, we rewrite (\ref{eqproof:value_porfolio_bs_1}) as
	
	\begin{align}
		d\valueProcess{t} &=  \frac{\valueProcess{t} - \pi(t)}{X_0}dX_0 + \frac{\pi(t)}{S_t} dS_t \nonumber\\
		&= \frac{\valueProcess{t} - \pi(t)}{B_t} dB_t + \frac{\pi(t)}{X_1} dS_t\nonumber\\
		&= \frac{\valueProcess{t} - \pi(t)}{B_t} r B_t dt + \frac{\pi(t)}{S_t} S_t(\mu dt + \sigma dW_t)\nonumber\\
		&= (\valueProcess{t} - \pi(t)) r B_t dt  + \pi(t)(\mu dt + \sigma dW_t) 	\nonumber\\
		&= [r\valueProcess{t} + (\mu - r) \pi(t)] dt + \sigma\pi(t) dW_t
	\end{align}
	
	Were we note that the normalized process follows the dynamics:
	\begin{align}
		d\valueProcessNorm{t} &= d\left(\valueProcess{t} \nu(t)\right) \nonumber \\
		&= \nu(t) d\valueProcess{t} + d\nu(t) \valueProcess{t} + d\nu(t) d\valueProcess{t} \nonumber \\
		&= \nu(t)([r\valueProcess{t} + (\mu - r) \pi(t)] dt + \sigma\pi(t) dW_t) - r \valueProcess{t}\nu(t)dt\nonumber\\
		&= \nu(t)(\mu - r) \pi(t) dt + \nu(t)\pi(t) \sigma dW_t \nonumber \\
		&= \hat \pi(t) (\mu - r) + \hat \pi(t) \sigma dW_t
	\end{align}
	
	In order for replication to occur we need
	\begin{equation}
		\valueProcess{T} = g(S_T) = C(T, S_T),
	\end{equation}
	i.e., if replication were to occur, the value of the portfolio at maturity must be the same as that of the payoff which, additionally, must be the value of the derivative at that time. It follows that
	
	\begin{equation}\label{eq:replication_condition}
		d\valueProcess{t} = dC(t, S_t).
	\end{equation}
	
	To compare (\ref{eq:replication_condition}) is to compare the stochastic element $dW_t$ and the deterministic component $dt$.
	
	%TODO: Argue that this allows the perfect replication of the portfolio regarding risky assets.
	\begin{equation}
		\pi(t) \sigma dW_t = \sigma S_t \partialwrt{C}{s}{(t, S_t)}dW_t \iff \pi(t) = S_t C_s, \text{ and}
	\end{equation}
	
	\begin{align}
		&[r\valueProcess{t} + (\mu - r) \pi(t)] dt = \left(C_t + \mu S_t C_s + \frac{1}{2}(S_t\sigma)^2C_{ss} \right) dt\nonumber\\
		\Rightarrow & [r(\valueProcess{t} - \pi(t)] + \mu\pi(t) = \left(C_t + \mu S_t C_s + \frac{1}{2}(S_t\sigma)^2C_{ss} \right) \nonumber\\
		\Rightarrow &[r(C - S_t C_s] + \mu S_t C_s = C_t + \mu S_t C_s + \frac{1}{2}(S_t\sigma)^2C_{ss} \nonumber \\
		\Rightarrow &[r(C - S_t C_s] = C_t + \frac{1}{2}(S_t\sigma)^2C_{ss} \nonumber \\
		\Rightarrow & C_t + \frac{1}{2}(S_t\sigma)^2C_{ss} + rS_t C_s - rC = 0
	\end{align}
 \end{proof}
 
 \begin{remark}
 	The Black-Scholes formula (\ref{eq:black-scholes-formula}), together with condition (\ref{eq:replication_condition}) means that we can replicate the payoff $g(S_T)$ if we adjust the portfolio accordingly. Furthermore, the price of the derivative at time $t$ does not depend on the mean return rate of the underlying $\mu$. Solving for $C$ then, implies getting the price of the derivative for which replication can be performed.
 \end{remark}
 
 \section{Risk-Neutral Pricing}
  Pricing under replication denotes the key idea behind the Black-Scholes model: the price of the option today is the cost of the self-financing portfolio that I (the seller) should buy at the beginning of the contract in order to guarantee the final payoff.\\
 
  Consider once again the two-security market proposed, condition (\ref{eq:condition_change_measure}) becomes
\[
	\sigma S_t u(t,\omega) = \mu S_t - r S_t \Rightarrow u = \sigma^{-1}(\mu - \sigma)
\]


As a consequence, we have an equivalent martingale measure $\Qm$ as defined on (\ref{eq:emmq}), hence no arbitrage by \ref{th:arbitrage_free_market}, and a complete market by \ref{th:arbitrage_free_market}

 
 One might inquire about the price in terms, not in replicating the option, but rather about the \textit{fair} price for which both parties to pay for both buyer and seller. 
 
 It turns out that, if the market is complete, 
 
 Another approach to value the option is to compute the expected value of the derivative under the risk-neutral probability $\Qm$. By Girsanov's Theorem, we know there exists a unique probability $\Qm$ under which $W^\Qm$ is a Brownian Motion. In fact, \ref{prop:qmartingale-market} guarantees that the discounted market value of the stock $S_t$ is a martingale
  
 \begin{equation}
 	\ExpMeasure{\Qm}{e^{-rT}g(S_T)} = \ExpMeasure{\Qm}{e^{-rT}[S_t - K]^+}
 \end{equation}

 
\end{document}